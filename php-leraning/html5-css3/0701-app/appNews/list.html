<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="css/mui.css"/>
</head>
<body>
    <header class="mui-bar mui-bar-nav">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
        <h1 class="mui-title">后盾新闻列表</h1>
    </header>
    <div class="mui-content">
	    	<div class="mui-content-padded">
	    		<h5>欢迎登陆后盾新闻客户端 <a href="javascript:;" id="logout">注销</a></h5>
	    </div>
        <ul class="mui-table-view" id="news-box">
            
        </ul>
    </div>
    <script src="js/mui.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
    mui.init()
    mui.plusReady(function(){
    		var logoutButton = document.getElementById("logout");
    		logoutButton.addEventListener('tap',function(){
    			mui.ajax('http://api.jiunixing.com/appNews/index.php?c=Account&a=logout',{
    				timeout:10000,
    				success:function(){
    					mui.back();
    				}
    			})
    		})
    		
    		//调取文章列表
    		mui.ajax('http://api.jiunixing.com/appNews/index.php?c=Arc&a=lists',{
    			timeout:10000,
    			type:'get',
    			dataType:'json',
    			success:function(phpData){
    				var li = '';
    				for (var i=0;i<phpData.length;i++) {
    					li += '<li data-id='+i+' class="mui-table-view-cell mui-media">';
                		li += '<a href="javascript:;">';
                    li += '<img class="mui-media-object mui-pull-left" src="'+phpData[i].img+'">';
                    li += '<div class="mui-media-body">' + phpData[i].title;
                    li += '<p class="mui-ellipsis">'+phpData[i].des+'</p>';
                    li += '</div></a></li>';
    				}
    				var newsBox = document.getElementById("news-box");
    				newsBox.innerHTML = li;
    				//点击每一个li跳转，必须放在异步里面
	    			mui('#news-box').on('tap','li',function(){
			    		mui.openWindow({
		    				url:'details.html',
		    				id : 'details',
		    				extras:{
		    					title:phpData[this.getAttribute('data-id')].title,
		    					des : phpData[this.getAttribute('data-id')].des,
		    				}
		    			})
		    		})
    			}
    			
    		})
    		
    		
    		
    		
    })
    </script>
</body>
</html>
